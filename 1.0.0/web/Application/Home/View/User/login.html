{/*
* @author 广州飞步信息科技有限公司
* @copyright 2015 - present
* @license GPL v3
*/}
<layout name="layoutLogin" />

<style type="text/css">
  #loading-mask {
    background-color: white;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    z-index: 20000;
  }

  #loading {
    height: auto;
    position: absolute;
    left: 45%;
    top: 40%;
    padding: 2px;
    z-index: 20001;
  }

  #loading .loading-indicator {
    background: white;
    color: #444;
    font: bold 13px Helvetica, Arial, sans-serif;
    height: auto;
    margin: 0;
    padding: 10px;
  }

  #loading-msg {
    font-size: 10px;
    font-weight: normal;
  }

  input {
    caret-color: #ad4e00;
    background: transparent !important;
    box-shadow: none !important;
    border-top: 0px solid transparent !important;
    border-left: 0px solid transparent !important;
    border-right: 0px solid transparent !important;
    border-bottom: 1px solid #dbdbdb !important;

    color: #030852 !important;
    font-weight: 500 !important;
    font-size: 130% !important;
  }

  input:focus {
    border-color: transparent transparent #3975d5 transparent !important;
    border-width: 2px !important;
  }

  input::placeholder {
    color: #ddd0d0 !important;
  }


</style>

<div id="loading-mask"></div>
<div id="loading">
  <div class="loading-indicator">
    <img src="{$uri}Public/Images/loader.gif" width="32" height="32"
      style="margin-right: 8px; float: left; vertical-align: top;" />
    欢迎使用{$productionName}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <br /> <span id="loading-msg">正在加载中，请稍候...</span>
  </div>
</div>

<script src="{$uri}Public/PCL/pcl.js" type="text/javascript"></script>
<script src="{$uri}Public/PCL/ext-lang-zh_CN.js" type="text/javascript"></script>
<script src="{$uri}Public/Scripts/PSI/Const.js?dt={$dtFlag}" type="text/javascript"></script>

<link href="{$uri}Public/Content/foundation/foundation.min.css" rel="stylesheet" type="text/css" />
<link href="{$uri}Public/Content/foundation/app.css" rel="stylesheet" type="text/css" />

<div class="container">
    <div id="wrapper" class="login-body">
        <div class="login-content">
            <div class="brand">
                <!-- <img alt="logo" class="brand-img" src="assets/store/img/login/logo.png"> -->
                <h2 class="brand-text">{$productionName}</h2>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
				    <input type="text" id="editLoginName" placeholder="登录名">
                    <!-- <input class="" name="User[user_name]" placeholder="请输入用户名" type="text" required=""> -->
                </div>
                <div class="form-group">
				 <input type="password" id="editPassword" placeholder="密码">
                    <!-- <input class="" name="User[password]" placeholder="请输入密码" type="password" required=""> -->
                </div>
                <div class="form-group">
                    <!-- <button id="btn-submit" type="submit"> -->
                        <!-- 登录 -->
                    <!-- </button> -->
					<a href="#" class="button expanded psi_secondary" id="buttonOK">登&nbsp;&nbsp;录</a>
                </div>
            </form>
        </div>
		<div class="copyright">
        <span>Copyright &copy; 2015-{$year} <br> 广州飞步信息科技有限公司, All Rights Reserved</span>
    </div>
    </div>
    
</div>


<style>
  .psi_content {
    margin: 20px;
    min-height: calc(100vh - 140px);
  }

  .footer {
    height: 50px;
  }
  body,html{
  height:100%}
  body{background:url({$uri}Public/Images/login-bg.jpg) no-repeat center/cover !important;overflow:hidden}
.login-body {
    
    vertical-align: middle;
    width: 400px;
	height:100%;
    margin: 10% auto;
    background: #fff;
    border-radius: 4px;
    padding: 50px 40px 40px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
	box-shadow: 0 5px 20px #999;
}
.copyright{text-align:center;color:#666;font-size:12px}
.login-content {
}

.login-content .brand .brand-img {
    width: 100px;
	display:block;
	margin:0 auto;
}

.login-content .brand .brand-text {
    margin-top: 10px;
    margin-bottom: 11px;
    font-size: 20px !important;
    font-family: "Microsoft YaHei";
    text-shadow: rgba(0, 0, 0, .15) 0 0 1px;
    font-weight: 400;
    color: #37474f;
	text-align:center;
}
.psi_secondary{background:#3975d5;color:#fff}
.psi_secondary:hover{background:#3975d5;opacity:0.9}
.login-form {
    margin: 45px 0 30px;
}

.login-form .form-group {
    margin: 30px 0;
}

.login-form input {
    display: block;
    border: 0;
    border-radius: 0;
    -webkit-box-shadow: none;
    box-shadow: none;
    width: 100%;
    border-bottom: 1px solid #E4EAEC;
    font-size: 14px;
    height: 42px;
    line-height: 1.5;
    outline: none;
    padding: 0 5px;
    color: #a3afb7;
    font: 14px/1.5 "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", FreeSans, Arimo, "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", Roboto, Arial, sans-serif;
    transition: all 0.3s ease-in-out;
    -moz-transition: all 0.3s ease-in-out;
    -webkit-transition: all 0.3s ease-in-out;
    -o-transition: all 0.3s ease-in-out;
}

.login-form input:focus {
    border-bottom: 1px solid #ff5060;
}

.login-form button {
    width: 100%;
    margin-top: 20px;
    padding: 10px 18px;
    font-size: 18px;
    line-height: 1.3333333;
    border-radius: 4px;
    white-space: normal;
    -webkit-transition: border .2s linear, color .2s linear, width .2s linear, background-color .2s linear;
    -o-transition: border .2s linear, color .2s linear, width .2s linear, background-color .2s linear;
    transition: border .2s linear, color .2s linear, width .2s linear, background-color .2s linear;
    -webkit-font-smoothing: subpixel-antialiased;
    color: #fff;
    background-color: #ff5060;
    /*border-color: #ff5060;*/
    border: 1px solid transparent;
    cursor: pointer;
    outline: none;
}

.login-form button[disabled], .login-form button[disabled]:hover {
    color: #fff;
    background-color: #a2caee;
    border-color: #a2caee;
    cursor: not-allowed;
    opacity: .65;
}

.login-form button:hover {
    background-color: #fd717e;
    border-color: #fd717e;
}

@media screen and (max-width: 404px) {
    .login-body {
        width: 310px;
        padding: 50px 30px 40px;
    }
}
</style>

<script type="text/javascript">
  PCL.onReady(() => {
    PSI.Const.BASE_URL = "{$uri}";

   

    var editLoginName = document.getElementById("editLoginName");
    var editPassword = document.getElementById("editPassword");
    var loginName = PCL.util.Cookies.get("PSI_user_login_name");
    if (loginName) {
      editLoginName.value = decodeURIComponent(loginName);
      editPassword.focus();
    } else {
      editLoginName.focus();
    }

    editLoginName.onkeydown = function (e) {
      if (e.keyCode == 13) {
        editPassword.focus();
      }
    };
    editPassword.onkeydown = function (e) {
      if (e.keyCode == 13) {
        doLogin(editLoginName.value, editPassword.value);
      }
    }
    document.getElementById("buttonOK").onclick = function () {
      doLogin(editLoginName.value, editPassword.value);
    }

    PCL.get("loading").remove();
    PCL.get("loading-mask").remove();
  });

  function doLogin(loginName, password) {
    if (!loginName) {
      showInfo("没有输入登录名");
      setInputFocus();
      return;
    }
    if (!password) {
      showInfo("没有输入密码");
      setInputFocus();
      return;
    }

    var r = {
      url: PSI.Const.BASE_URL + "Home/User/loginPOST",
      method: "POST",
      params: {
        loginName: loginName,
        password: password
      },
      callback: function (options, success, response) {
        if (success) {
          var data = PCL.JSON.decode(response.responseText);
          if (data.success) {
            setLoginNameToCookie(loginName);

            var returnPage = "{$returnPage}";
            if (returnPage) {
              location.replace(returnPage);
            } else {
              location.replace(PSI.Const.BASE_URL);
            }
          } else {
            showInfo(data.msg);
            setInputFocus();
          }
        }
      }
    };

    PCL.Ajax.request(r);
  }

  function setInputFocus() {
    var editLoginName = document.getElementById("editLoginName");
    var editPassword = document.getElementById("editPassword");
    if (editLoginName.value) {
      editPassword.focus();
    } else {
      editLoginName.focus();
    }
  }

  function showInfo(info) {
    document.getElementById("divInfoCallout").style.display = "";
    document.getElementById("divInfo").innerHTML = info;
  }

  function setLoginNameToCookie(loginName) {
    loginName = encodeURIComponent(loginName);
    const dt = PCL.Date.add(new Date(), PCL.Date.YEAR, 1);
    PCL.util.Cookies.set("PSI_user_login_name", loginName, dt);
  }
</script>
